package com.web.util;

import java.util.Calendar;
import java.util.Date;
import java.util.Timer;
import java.util.TimerTask;

import com.admin.controller.CpApplicationController;
import com.admin.controller.GqbController;
import com.admin.service.impl.MncpServiceImpl;

/**
 * 股票买卖定时器
 * 
 * @author Administrator
 * 
 */
public class GpMMTimer {
	static int count = 0;

	public static void showTimer() {
		TimerTask task = new TimerTask() {
			@Override
			public void run() {
				++count;
				String nowTime = TimeUtils.getTime("yyyy-MM-dd HH:mm:ss");
				String nowDay = TimeUtils.getTime("yyyy-MM-dd");
				String jd = nowDay + " 09:30:00";
				String syd = nowDay + " 11:30:00";
				String ydpm = nowDay + " 13:30:00";
				String ssd = nowDay + " 15:30:00";
				Date nowTime1 = TimeUtils.getTime("yyyy-MM-dd HH:mm:ss",
						nowTime);
				Date jd1 = TimeUtils.getTime("yyyy-MM-dd HH:mm:ss", jd);
				Date syd1 = TimeUtils.getTime("yyyy-MM-dd HH:mm:ss", syd);
				Date ydpm1 = TimeUtils.getTime("yyyy-MM-dd HH:mm:ss", ydpm);
				Date ssd1 = TimeUtils.getTime("yyyy-MM-dd HH:mm:ss", ssd);

				if ((jd1.before(nowTime1) && nowTime1.before(syd1))
						|| (ydpm1.before(nowTime1) && nowTime1.before(ssd1))) {

					MncpServiceImpl mncp = new MncpServiceImpl();

					// 添加需要执行的任务

					try {
						mncp.gpMmCjUpdate();
					} catch (Exception e) {

						e.printStackTrace();
					}
				}

			}
		};

		// 设置执行时间
		Calendar calendar = Calendar.getInstance();
		int year = calendar.get(Calendar.YEAR);
		int month = calendar.get(Calendar.MONTH);
		int day = calendar.get(Calendar.DAY_OF_MONTH);// 每天
		int day_of_week = calendar.get(Calendar.DAY_OF_WEEK) - 1; // 获取星期数（星期天 -
																	// 星期六：1-7）

		int hour24 = calendar.get(Calendar.HOUR_OF_DAY); // 24小时制
		int minute = calendar.get(Calendar.MINUTE); // 当前分
		int second = calendar.get(Calendar.SECOND); // 当前分

		if (day_of_week >= 1 && day_of_week <= 5) {
			// 定制每天的15:05:00执行，
			calendar.set(year, month, day, 9, 30, 00);
			Date date = calendar.getTime();
			Timer timer = new Timer();
			//System.out.println(date);

			int period = 24 * 60 * 60 * 1000;// 执行的时间间隔，1000为1秒，60*1000为1分钟，60*60*1000为一小时，24*60*60*1000为一天
			int period1 = 1000 * 60 * 5;
			timer.schedule(task, date, period1);// 每隔五分钟执行一次

			// 每天的date时刻执行task, 仅执行一次
			// timer.schedule(task, date);
		} else {
			//System.out.println("非交易日，不结算！");
		}

	}

	public static void main(String[] args) throws Exception {
		MncpServiceImpl mncp = new MncpServiceImpl();
		mncp.gpMmCjUpdate();
		showTimer();

	}
}