<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
(function(){
var phoneWidth = parseInt(window.screen.width), phoneScale = phoneWidth/320, ua = navigator.userAgent;
if (/Android (\d+\.\d+)/.test(ua)){
	var version = parseFloat(RegExp.$1);
	if(version > 2.3){
		document.write('<meta name="viewport" content="width=320, initial-scale=1, user-scalable=0">');
	}else{
		document.write('<meta name="viewport" content="width=320, target-densitydpi=device-dpi">');
	}
// 其他系统
} else {
	document.write('<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">');
}
})();
</script>
<style type="text/css">
body{ width:100%; height:100%; margin:0; padding:0; color:#000; background:#f7f7f7; width:100%; cursor:default; font-family: 'Microsoft yahei';}
.loads{ width:100%; min-height:200px; height:100%; background:url(images/loading.gif) no-repeat center center;}
#newcont	{ width:92%; height:100%; margin:0 auto;}
h2{ width:100%; padding:10px 0 0 0; font-size:20px; text-align:center; display:block;}
h6{ width:100%; height:30px; font-size:10px; border-bottom:1px solid #efefef; padding-bottom:5px; text-align:center; display:block; font-weight:normal; color:#666;}
h5{ width:100%; font-weight:normal; font-size:14px; overflow:hide;}
h5 img	{ width:100%;}
.imgbox	{ width:100%; height:100px; margin:0; padding:0 0 10px 0;}
.imgbox img	{ width:19%; height:80px; background:#fff; padding:4px; margin:0 1%; border:1px solid #efefef; float:left;}
.header	{ width:100%; height:100px; background:#fff; color:#666; font-size:10px; display:none;}
.header img	{ margin:20px; float:left;}
.header div	{ float:left; line-height:20px; margin:20px 0 0 0;}
.header div b	{ font-size:16px; color:#000;}
.header a	{ float:right; padding:10px 20px; border:1px solid #e2e2e2; color:#e34814; text-decoration:none; font-size:14px; font-weight:bold; margin:30px 20px 0 0; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px;}
.good{ line-height:30px; height:30px; color:#999; font-size:13px; font-weight:normal; padding:6px 8px; margin:15px 0 0 5px; border:1px solid #efefef; display:inline; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; background:#fff;}
.good:hover{background:#efefef;}
.good img{margin:-4px 0 0 0;}
.good span	{ color:#CC0000;}
.dasangbox	{ width:96%; margin:0 auto; padding:20px 2%; border-top:1px solid #efefef; background:#fff;}
.dasangbox .note { width:100%; color:#999; text-align:center; padding:20px 0 0 0;}
.dasang { width:50%; padding:4px 8px; margin:0 auto; border:1px solid #efefef; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; font-size:13px;}
.dasang:hover{background:#efefef;}
.pinlun	{ width:100%; margin:0 auto; padding:10px 0; border-top:1px solid #efefef; color:#999; font-size:13px; line-height:25px;}
.pinlun .plbox	{ width:96%; min-height:65px; margin:0 auto; padding:20px 2% 10px 2%; border-bottom:1px solid #efefef; border-top:1px solid #efefef; background:#fff;}
.pinlun .plbox .face	{ width:60px; height:60px; margin:0 10px 0 0; float:left; padding:5px; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; border:1px solid #f6f6f6; background:#fff;}
.pinlun .plbox b	{ color:#333;}
.pinlun .plbox .good{padding:2px 4px; margin:-5px 0 0 5px; border:1px solid #efefef; float:right; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; background:#fff; font-size:12px;}
.pinlun .plbox .good:hover{background:#efefef;}
.pinlun .plbox .good img{margin:-4px 0 0 0;}
.pinlun .plplbox	{ width:100%; padding:0;}
.pinlun .plplcont	{ line-height:30px; background:#f7f7f7; padding:0 0 0 20%;}
.pinlun .plplcont b	{ color:#111;}
.pinlun .plplcont .red	{color:#cc0000;}
.textboxcont	{width:94%; height:90px; border:1px solid #efefef; margin:10px auto;}
.tbtn:hover	{background:#f7f7f7;}
</style>
<link href="source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" rel="stylesheet" type="text/css"  />
<link href="source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" media="screen" />
<title>股天乐 - 新闻线</title>
<script src="js/jquery183.js" type="text/javascript"></script>
<script src="js/jquery.SuperSlide.2.1.js" type="text/javascript"></script>
<script src="js/effect.js" type="text/javascript"></script>
<script src="js/queryString.js" type="text/javascript"></script>
<script src="source/jquery.fancybox.js?v=2.1.5" type="text/javascript"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script type="text/javascript">
var wzid = null;
var nEditor;
var data;
var myface = "<%=(String)request.getSession().getAttribute("tx")%>";
var udef = null;
var shareData = {
	title: "股天乐最新信息",
	desc: "股天乐最新信息",
	link: window.location.href,
	imgUrl: "http://www.gtl666.com/images/gutl.png",
	type: "",
	dataUrl: "",
	success: function (res) { },
	cancel: function (res) { }
}

function callbacks(data){
	wx.config({
	    debug: false,
	    appId: data.appId,
	    timestamp: data.TimeStamp,
	    nonceStr: data.NonceStr,
	    signature: data.Signature,
	    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage']
	});

	wx.ready(function () {
		wx.onMenuShareTimeline({
			title: shareData.desc,
			link: shareData.link,
			imgUrl: shareData.imgUrl,
			success: shareData.success,
			cancel: shareData.cancel
		});

		wx.onMenuShareAppMessage({
			title: shareData.title,
			desc: shareData.desc,
			link: shareData.link,
			imgUrl: shareData.imgUrl,
			type: shareData.type,
			dataUrl: shareData.dataUrl,
			success: shareData.success,
			cancel: shareData.cancel
		});
	});
}

$(function(){
	$.ajax({
		type:"get", 
		data:{"jsonpcallback":"callbacks","apply_name":"wlj","apply_url":location.href.split('#')[0]}, 
		url:"http://all.wx.mrzhuo.com/api_jsapi/get_port.aspx", 
		dataType:"jsonp", 
		jsonp:"callback"
	});
	
	//$('.fancybox').fancybox();
	var ua = navigator.userAgent.toLowerCase();//获取判断用的对象
	if (ua.match(/MicroMessenger/i) == "micromessenger") {
		$(".header").show();
	}
	if (ua.match(/WeiBo/i) == "weibo") {
		$(".header").show();
	}
	if (ua.match(/QQ/i) == "qq") {
		$(".header").show();
	}
        
	var id = getQueryString("id");
	var u = getQueryString("u");
	$.get("../servlet/TGQservlet?method=tgdjDetail&tgdjid="+ id + "&u=" + u, function(data) {
		//alert(data);
		var imgstr = "";
		var endstr = "";
		data = JSON.parse(data);
		if(data.errorCode == "0"){
			if(data.image != ""){
				if(data.image.indexOf(",") > 0){
					var imgbox = data.image.split(",");
					for(var i = 0; i < imgbox.length; i++){
						if(imgbox[i].length > 0){
							imgstr += "<img src='"+imgbox[i]+"' width='100%' /><br/>";
						}
					}
				}else{
					if(data.image != ",,,"){
						imgstr += "<img src='"+data.image+"' width='100%' /><br/>";
					}
				}
			}
			endstr += "<h2>"+data.title+"</h2>";
			endstr += "<h6 class='xinxi'>"+data.add_time+" | 来源："+data.author+"  <div class=\"good zandj\"><img src=\"../images/p.good.png\" width=\"20\" align=\"absmiddle\" /> 好评 (<span class=\"goodnum\">"+data.zan+"</span>)</div></h6>";
			endstr += "<h5>"+imgstr+"<br/>"+data.content+"</h5>";
			if(data.tgid){
				$("#dashangpar").attr("alt","?fwid="+data.tgid+"&u="+getQueryString("u"));
			}else{
				$("#dashangpar").attr("alt","?fwid=aaaa&u="+getQueryString("u"));
			}
		}else{
			endstr = "<h5>"+data.errorMsg+"</h5>";
		}
		$("#newcont").html(endstr);
	});
	
	$(".zandj").click(function(){
		//alert($(this).attr("alt"));
		var obj = $(this);
		
		$.ajax({
			url:"../servlet/genericGtl",
			data:{"sort":"other","pars":"type~tgdjdz+tgdjid~"+$(this).attr("alt")+"+zan~1+duser~"+getQueryString("id"),"zanid":$(this).attr("alt")},
			dataType:"json",
			type:"post",
			success:function(data){
				//var das = JSON.stringify(data);
				//alert(das);
				if(data.errorCode == 0){
					obj.find("span").html(Number(obj.find("span").html())+1);
				}else{
					trace(data.errorMsg);
				}
			},
			error:function(e){
				trace("系统错误，请稍后再试！");
			}
		});
	});
	
	$(".dasang").click(function(){
		setupWebViewJavascriptBridge(function(bridge) {
			bridge.callHandler('submitFromWeb', {'type':"dasang"}, function(response) {
				log('JS got response', response)
			});
		});

		//var par = $(this).attr("alt");
		//if(par == ""){
		//	trace("请等待数据加载完毕！");
		//	return;
		//}
		//openwindow("../dashang.jsp"+par,250,"90%","5%");
	});
});


function resrc(str){
	if(str){
		var endstr = str.replace(/src=\"/g,"src=\"http://admin.gtl666.com");
		return endstr;
	}else{
		return "";
	}
}

function rehtml(con){
	var endstr = con;
	endstr = endstr.replace(/\&lt;/g, "<");
	endstr = endstr.replace(/\&gt;/g, ">");
	endstr = endstr.replace(/\&amp;/g, "&");
	endstr = endstr.replace(/\&quot;/g, "\"");
	//alert(endstr);
	return endstr;
}

function loadtalks(id){;
	var wzids = (id) ? id : wzid;
	//alert(wzid);
	$.ajax({
		url:"../servlet/genericGtl",
		data:{"wzid":wzids,"sort":"plload"},
		dataType:"json",
		type:"post",
		success:function(data){
			//var das = JSON.stringify(data);
			//alert(das);
			
			var plstr = "";
			var faces = "";
			for(var i = 0; i < data.rows.length; i++){
				if(data.rows[i].tx != ""){
					faces = "<img src='"+data.rows[i].tx+"' class='face' />";
				}else{
					faces = "<img src='../images/myface.jpg' class='face' />";
				}
				plstr += "<div class='plbox'>";
				//plstr += "<div class='good pinl' alt='"+data.rows[i].plid+"'><img src='../images/p.pinlun.png' width='20' align='absmiddle' /> 回复</div>";
				plstr += "<div class='good zan' alt='"+data.rows[i].plid+"'><img src='../images/p.good.png' width='20' align='absmiddle' /> 支持(<span>"+data.rows[i].zan+"</span>)</div>";
      	   		plstr += faces + "<b>" + data.rows[i].nickname+"</b><br />"+data.rows[i].time+" "+" <b>说：</b>";
      	   		plstr += "<p class='conts'>"+data.rows[i].content+"</p>";
      	   		plstr += "</div><div class='plplbox'>";
      	   		for(var x = 0; x < data.rows[i].plpl.length; x++){
      	   			if(data.rows[i].plpl[x].userid == "<%=(String)request.getSession().getAttribute("userid")%>"){
      	   				plstr += "<div class='plplcont'><b class='red'>我 </b> 说： "+data.rows[i].plpl[x].content+"</div>";
      	   			}else{
      	   				plstr += "<div class='plplcont'><b>"+data.rows[i].plpl[x].username+"</b> 说： "+data.rows[i].plpl[x].content+"</div>";
      	   			}
  	   			}
      	   		plstr += "</div>";
			}
			
			//alert(plstr);
			$(".pinlun").html(plstr);
			buildClick();
		},
		error:function(e){
			trace("系统错误，请稍后再试！");
		}
	});
}
function buildClick(){
	$(".zan").click(function(){
		//alert($(this).attr("alt"));
		var obj = $(this);
		
		$.ajax({
			url:"../servlet/genericGtl",
			data:{"sort":"other","pars":"type~plzan+plid~"+$(this).attr("alt")+"+zan~1","zanid":$(this).attr("alt")},
			dataType:"json",
			type:"post",
			success:function(data){
				//var das = JSON.stringify(data);
				//alert(das);
				if(data.errorCode == 0){
					obj.find("span").html(Number(obj.find("span").html())+1);
				}else{
					trace(data.errorMsg);
				}
			},
			error:function(e){
				trace("系统错误，请稍后再试！");
			}
		});
	});
	
	$(".pinl").click(function(){
		var cont = "<b>您正在回复：</b>"+$(this).parent().find(".conts").html();
		var plid = $(this).attr("alt");
		textbox(cont,function(e){
			$.ajax({
				url:"../servlet/genericGtl",
				data:{"sort":"otheruser","pars":"type~plpladd+plid~"+plid+"+content~"+e,"u":getQueryString("u")},
				dataType:"json",
				type:"post",
				success:function(data){
					//var das = JSON.stringify(data);
					//alert(das);
					
					if(data.errorCode == 0){
						//$(".plplbox").append("<div class='plplcont'><b class='red'>我 </b> 说： "+e+"</div>");
						window.location.reload();
						//obj.find("span").html(Number(obj.find("span").html())+1);
					}else{
						//trace(data.errorMsg);
					}
				},
				error:function(e){
					alert("系统错误，请稍后再试！");
				}
			});
		},90);
	});
}

function setupWebViewJavascriptBridge(callback) {
	if (window.WebViewJavascriptBridge) {
		return callback(WebViewJavascriptBridge);
	}
	if (window.WVJBCallbacks) {
		return window.WVJBCallbacks.push(callback);
	}
	window.WVJBCallbacks = [ callback ];
	var WVJBIframe = document.createElement('iframe');
	WVJBIframe.style.display = 'none';
	WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
	document.documentElement.appendChild(WVJBIframe);
	setTimeout(function() {
		document.documentElement.removeChild(WVJBIframe)
	}, 0)
}

setupWebViewJavascriptBridge(function(bridge) {
	var uniqueId = 1
	bridge.registerHandler('functionInJs',
			function(data, responseCallback) {
				addComment(data);
			})
	bridge.registerHandler('functionInJs2',
			function(data, responseCallback) {
				isregister = true;
				var responseData = {
					'Javascript Says' : 'Right back atcha!'
				}
				$(".regBtnDiv").html("已经报名");
				$(".regBtnDiv").css("background-color", "#D3D3D3");
			})
	bridge.registerHandler("functionInJs3",
			function(data, responseCallback) {
				data = eval('(' + data + ')');
				if(iszan == 1){
					iszan = 0;
					var zanCount = $("#zan").html();
					zanCount = parseInt(zanCount) - 1;
					$("#zan").html(zanCount);
					$("#zanImg").attr("src", "http://ihome.nw-sc.com:80/nwclAPI/images/saving@2x.png");
				}else{
					iszan = 1;
					var zanCount = $("#zan").html();
					zanCount = parseInt(zanCount) + 1;
					$("#zan").html(zanCount);
					$("#zanImg").attr("src", "http://ihome.nw-sc.com:80/nwclAPI/images/haszan.png");
				}
			});
})
var isregister = false;

</script>
</head>

<body>
<div class="header">
	<a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.wauwo.gtl">立即打开</a>
	<img src="../images/gutl.png" width="60" height="60" />
	<div><b>股天乐</b><br/>专业投顾导航</br>为你点股成金</div>
</div>
<!--中间板块内容-->
<div id="newcont">
	<div class="loads"></div>
</div>
<div class="dasangbox">
	<div class="dasang" id="dashangpar" alt="">
		<img src="../images/dashang.png" width="80" align="absmiddle" /> 我很喜欢！赏！
	</div>
	<div class="note">客官，如果您觉得此文章对你有帮助，不妨打赏一点，让作者发布更多的好文章！</div>
</div>
<div class="pinlun">
	
</div>
</body>
</html>