package com.lcjh.controller.admin.lcjh;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.util.Assert;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.admin.pageModel.DataGrid;
import com.lcjh.biz.Lcjh2Biz;
import com.lcjh.entity.Lcjh2;
import com.lcjh.result.BooleanBaseResult;

/**
 * 理财计划控制器
 * 
 * @author
 * 
 */
@Controller
@RequestMapping("/lcjh2Controller")
public class Lcjh2Controller {

	@Autowired private Lcjh2Biz lcjh2Biz;
	/**
	 * 跳转到理财计划列表页面
	 * 
	 * @return
	 */
	@RequestMapping("/manager")
	public String manager(HttpServletRequest request) {
		return "/admin/lcjh2/list";
	}
	
	@RequestMapping("/top")
	@ResponseBody
	public BooleanBaseResult top(HttpServletRequest request, String id, int type) {
		Lcjh2 l = lcjh2Biz.get(Lcjh2.class, id);
		Assert.notNull(l, "该信息不存在");
		if(1 == type){
			String sql = "select max(isTop) from Lcjh2";
			int maxTop = lcjh2Biz.count(sql, null);
			l.setIsTop(maxTop + 1);
			lcjh2Biz.update(l);
		}else{
			l.setIsTop(0);
			lcjh2Biz.update(l);
		}
		return BooleanBaseResult.SUCCESS;
	}

	/**
	 * 获得理财计划列表数据
	 * 
	 * @return
	 */
	@RequestMapping("/dataGrid")
	@ResponseBody
	public DataGrid dataGrid(HttpServletRequest request, int page, int rows, String title) {
		String hql = "from Lcjh2 where 1=1 ";
		String hqlCount = "select count(1) from Lcjh2 where 1=1 ";
		Map<String, Object> params = null;
		if(StringUtils.hasText(title)){
			title = "%" + title + "%";
			params = new HashMap<String, Object>();
			params.put("title", title);
			hql += " and jhbt like :title";
			hqlCount += " and jhbt like :title";
		}
		hql += " order by isTop desc, addTime desc";
		List<Lcjh2> list = lcjh2Biz.find(hql, params, page, rows);
		long total = lcjh2Biz.count(hqlCount, params);
		DataGrid dg = new DataGrid();
		dg.setRows(list);
		dg.setTotal(total);
		return dg;
	}

}
