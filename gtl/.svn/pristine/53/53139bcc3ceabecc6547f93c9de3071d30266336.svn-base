package com.log;

import javax.servlet.http.HttpServletRequest;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.stereotype.Controller;
import org.springframework.util.StopWatch;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;

import springfox.documentation.builders.PathSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
@EnableWebMvc
@Controller
public class MySwaggerConfig{
	
	private final Logger log = LoggerFactory.getLogger(MySwaggerConfig.class);
    public static final String DEFAULT_INCLUDE_PATTERN = "/api/.*";
	
	@RequestMapping(value="apidoc")
	public String api(HttpServletRequest request){
		return "WEB-INF/swagger";
	}
	
    @Bean
    public Docket customDocket() {
    	log.debug("启动swagger...");
        StopWatch watch = new StopWatch();
        watch.start();
        Docket swaggerSpringMvcPlugin = new Docket(DocumentationType.SWAGGER_2)
        		.apiInfo(apiInfo())
				.select()								//选择哪些路径和API会生成document
				//.apis(RequestHandlerSelectors.any())	//对所有api进行监控
				.paths(PathSelectors.regex("/api/.*")) 	//对所有路径进行监控
				.build();
        watch.stop();
        log.debug("swagger启动成功，耗时  {} ms", watch.getTotalTimeMillis());
        return swaggerSpringMvcPlugin;
    }

	private ApiInfo apiInfo() {
		Contact contact = new Contact("liuguo", "", "liuguo@bolaa.com");
		ApiInfo apiInfo = new ApiInfo(
				"API接口", // 大标题 title
				"API接口", // 小标题
				"0.0.1", // 版本
				"", // termsOfServiceUrl
				contact, // 作者
				"", // 链接显示文字
				""// 网站链接
		);
		return apiInfo;
	}
}
