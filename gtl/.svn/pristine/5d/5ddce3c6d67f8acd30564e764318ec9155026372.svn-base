package com.log;

import java.util.Date;

import javax.servlet.ServletContextEvent;

import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.support.WebApplicationContextUtils;

import cn.lg.generic.slf4j.logback.LogbackConfigListener;

import com.lcjh.biz.LcjhConfigBiz;
import com.lcjh.biz.LcjhLabelBiz;
import com.lcjh.entity.LcjhConfig;
import com.lcjh.entity.LcjhLabel;

public class LogConfigListener extends LogbackConfigListener {

	@Override
	public void contextInitialized(ServletContextEvent event) {
		PROJECT_NAME = "gtl";
		super.contextInitialized(event);
		
		
		WebApplicationContext w = WebApplicationContextUtils.getWebApplicationContext(event.getServletContext());
		if(null == w){
			return;
		}
		LcjhConfigBiz lcjhConfigBiz = w.getBean(LcjhConfigBiz.class);
		if(null == lcjhConfigBiz){
			return;
		}
		LcjhConfig lcjhConfig = lcjhConfigBiz.get(LcjhConfig.class, 1);
		if(null == lcjhConfig){
			lcjhConfig = new LcjhConfig();
			lcjhConfig.setId(1);
			lcjhConfig.setHighComments(8);
			lcjhConfig.setMiddleComments(6);
			lcjhConfig.setLowComments(6);
			lcjhConfig.setMaxCj(3);
			lcjhConfig.setNotBuySeeCount(3);
			lcjhConfig.setStartGoldCoins(1000000);
			lcjhConfigBiz.save(lcjhConfig);
		}
		ProjectConfig.getLcjhConfig(false, lcjhConfig);
		LcjhLabelBiz labelBiz = w.getBean(LcjhLabelBiz.class);
		if(null == labelBiz){
			return;
		}
		String[] labelsStr = {"技术短炒", "追逐热点", "价值选股", "挖掘成长", "稳健耐心", "激进高效", "长短线结合"};
		String condition;
		LcjhLabel label;
		for (String labelStr : labelsStr) {
			condition = "from LcjhLabel where name='"+labelStr+"'";
			label = labelBiz.get(condition);
			if(null == label){
				label = new LcjhLabel();
				label.setName(labelStr);
				label.setAddTime(new Date());
				labelBiz.save(label);
			}
		}
		
	}
	
}
