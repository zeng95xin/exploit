<%@ page language="java" import="java.util.*" contentType="text/html; charset=UTF-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="pg" uri="http://jsptags.com/tags/navigation/pager" %>
<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no,initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>选手信息</title>
	<script type="text/javascript" src="js/jquery.min.1.7.js"></script>
	<script type="text/javascript" src="js/wx.js"></script>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="css/base.css">
    <script type="text/javascript" src="js/iscroll.js"></script>
    <style type="text/css">
    	#xsxx{background:url(images/p2_bg.png) repeat center top;top:0px;}
    	#xs_1{background:url(images/p2_b2_4.png) no-repeat center bottom;width: 100%;height: 230px;position: relative;top:200px;}
    	#tj0{width: 640px;height: 50px;background: url(images/p2_b2_2.png) no-repeat center bottom;top:150px;}
        #tj1{background: url(images/p2_b2_1.png) no-repeat center bottom;width: 100%;height: 125px;top:287px;}
        #p_data a{margin-top: 5px;}
        #p7{height: 1136px}
    </style>

</head>
<body id="bg1_1_1">
<!-- <div id="wrapper" style="height: 1130px;width:640px;">
<div class="scroll" style="width: 640px;height: auto;"> -->
<img width="200px;" height="200px" src="images/share.jpg" style="display: none">
<form action="query.do"  id="queryform" method="post">
<input type="text" name="openid" id="openid" hidden="hidden" value="${openid }">
<input type="text" id="tj_type" name="tj_type" hidden="hidden" value="${tj_type }"/>


<div class="page" id="xsxx" style="text-align: center;height: auto;">
    <div id="xx" style="height: auto;width: 100%;top:250px;position: relative;">
    			<c:forEach items="${pm.datas }" var="xx" varStatus="i">
    				<c:choose>
    					<c:when test="${i.index%2>0 }">
    						<div class="data" style="margin-top: 60px;margin-left: 340px;position: relative;margin-top: -388px;width: 261px;height: 390px;background-color: white;">
    							<img style="width: 220px;height: 280px;  margin-top: 23px" src="http://force.ser1.ford001.com/haier/userimages/user&1${xx.openid }${xx.photo}" onclick="fndetail('${xx.id}')"><br>
    							<span>${xx.name }</span><span style="margin-left: 30px;">票数</span>${xx.ps }<br>
    							
    							<c:choose>
    								<c:when test="${xx.id>=100 }">
    									<div class="tpbh">编号${xx.id }</div>
    								</c:when>
    								<c:when test="${xx.id>=10 }">
    									<div class="tpbh">编号0${xx.id }</div>
    								</c:when>
    								<c:otherwise>
    									<div class="tpbh">编号00${xx.id }</div>
    								</c:otherwise>
    							</c:choose>
    							
    							
    							
    							&nbsp;&nbsp;<div class="tp" style="position: relative;margin-top: -15px" onclick="fntp('${xx.id}','${xx.openid }','${openid }')">
    								<img src="images/p1_tp.png" class="tp_img">
    							</div>
    							<br>
    						</div>
    					</c:when>
    					<c:otherwise>
    						<div class="data" style="margin-top: 60px;margin-left: 38px;position: relative;width: 261px;height: 390px;background-color: white;">
    							<img style="width: 220px;height: 280px;  margin-top: 23px" src="http://force.ser1.ford001.com/haier/userimages/user&1${xx.openid }${xx.photo}" onclick="fndetail

('${xx.id}')"><br>
    							<span>${xx.name }</span><span style="margin-left: 30px;">票数</span>${xx.ps }<br>
    							<c:choose>
    								<c:when test="${xx.id>=100 }">
    									<div class="tpbh">编号${xx.id }</div>
    								</c:when>
    								<c:when test="${xx.id>=10 }">
    									<div class="tpbh">编号0${xx.id }</div>
    								</c:when>
    								<c:otherwise>
    									<div class="tpbh">编号00${xx.id }</div>
    								</c:otherwise>
    							</c:choose>
    							
    							&nbsp;&nbsp;
    							<div class="tp" style="position: relative;margin-top: -15px" onclick="fntp('${xx.id}','${xx.openid }','${openid }')">
    								<img src="images/p1_tp.png" class="tp_img">
    							</div>
    						</div>
    					</c:otherwise>
    				</c:choose>
    				
    			</c:forEach>
    			<div id="p_data" style="margin-top:100px;text-align: center;width: 100%;height: 40px;font-size: 36px;background-color: #363c3c;position: relative;">
    				<pg:pager url="query.do" items="${pm.total }" scope = "request" export="currentPageNumber=pageNumber" maxPageItems="10" isOffset="true">		
						<pg:first>
							<a href="${pageUrl}" id="firstpageurl" >首页</a>
						</pg:first>
						<pg:prev>
							<a href="${pageUrl}&tj_type=${tj_type }">上翻</a>
						</pg:prev>
						<pg:pages>
							<c:choose>
								<c:when test="${currentPageNumber eq pageNumber }">
									<font color="red">${pageNumber }</font>
								</c:when>
								<c:otherwise>
									<a href="${pageUrl}&tj_type=${tj_type }">${pageNumber }</a>
								</c:otherwise>
							</c:choose>
						</pg:pages>
						<pg:next>
							<a href="${pageUrl }&tj_type=${tj_type }">下翻</a>
						</pg:next>
						<pg:last>
							<a href="${pageUrl }&tj_type=${tj_type }">末页</a>
						</pg:last>
					</pg:pager>
    			</div>
    			<div style="height: 400px;position: relative;"></div>
    		</div>
   </div> 
   <!-- </div>
   </div> -->
</form>


<script type="text/javascript">

$("#p7").height(window.parent.innerHeight * 640 / window.parent.innerWidth);

function fnsu(){
	$("#queryform").submit();
}

//条件选择
$("#t_td_tj_1").click(function(){
	$("#tj_type").val("type1");

	$("#queryform").submit();
});
$("#t_td_tj_2").click(function(){
	$("#tj_type").val("type2");

	$("#queryform").submit();
});
$("#t_td_tj_3").click(function(){
	$("#tj_type").val("type3");

	$("#queryform").submit();
});
$("#t_td_tj_4").click(function(){
	$("#tj_type").val("type4");

	$("#queryform").submit();
});


$("#p7_1_1").click(function(){
	$("#p7_i_1").show();
});

$("#p7_i_1").click(function(){
	$("#p7_i_1").hide();
});

//跳转至个人信息页面
function fndetail(id){
	$("#p1_9_1_1_1", parent.document).css("display","none");
	var url = encodeURI(encodeURI("index.do?method=getInfo1&id=" + id));
	$.ajax({
		type : "POST",
		url : url,
		dataType : "json",
		success : function(data) {
			
      		var re=data.save;

      		var strs= new Array(); //定义一数组 
      		strs=re.split("="); 

      		
      		
      		var id_=strs[0];
      		var name=strs[1];
      		var xy=strs[2];
      		var photo=strs[3];
      		var ps=strs[4];
      		var pm=parseInt(strs[5])+1;
      		var openid=strs[6];
      		
      		var bh="";
      		if(parseInt(id_)>100){
      			bh=id_;
      		}else if(parseInt(id_)>10){
      			bh="0"+id_;
      		}else{
      			bh="00"+id_;
      		}
      		
      		$("#p7_pm").val("排名"+pm);
      		$("#p7_s_2").html("票数:"+ps);
      		$("#p7_name").html(name);
      		$("#p7_xy").val(xy);
      		$("#p7_bh").val("编号"+bh);
      		$("#p7_1_1").attr("src","http://force.ser1.ford001.com/haier/userimages/user&1"+openid+photo);
      		$("#p7_img").attr("src","http://force.ser1.ford001.com/haier/userimages/user&1"+openid+photo);
      		$("#p7_id").val(id_);
      		$("#p7_openid").val($("#openid").val());
      		$("#xsxx").hide();
      		$("#p7").show();
      		
		}
	});
}


//首页
function fnsy(){
	top.document.location.href="index.do";
}

//个人信息页分享
function fnzf(){
	$("#p2").show();
	var bh=parseInt($("#p7_id").val());
	var a="";
	if(bh>100){
		a=bh;
	}else if(bh>=10){
		a="0"+bh;
	}else{
		a="00"+bh;
	}
	var openid=$("#p7_openid").val();
	var photo=$("#p7_1_1").attr("src");
	WXENV.shareData.desc ="海尔水小盒第一季摄影大赛，我是"+a+"号，请为我的幸福加油助力";
	WXENV.shareData.imgUrl ="http://force.ser1.ford001.com/haier/"+photo, 
	WXENV.shareData.link='http://force.ser1.ford001.com/haier/index.do?id='+bh, 
	WXENV.updateShareData();
	
	
	var opid=$("#openid").val();
	if(photo.indexOf(opid)>0){//自己每天转发一次给自己加三票
		var url = encodeURI(encodeURI("index.do?method=zfjp&id=" + bh+"&openid="+opid));
		$.ajax({
			type : "POST",
			url : url,
			dataType : "json",
			success : function(data) {
				
			}
		});
	}
	
};

var sfkytp=false;
iskt();
function iskt(){
	var openid="${openid}";
	var url = encodeURI(encodeURI("index.do?method=iskt&openid="+openid));

	$.ajax({
		type : "POST",
		url : url,
		dataType : "json",
		success : function(data) {
			sfkytp=data.tp;
	
		}
	});
	
}



function fntoupiao(){
	var s=$("#p7_img").attr("src");
	var openid=$("#openid").val();
	if(s.indexOf(openid)>0){
		alert("不能给自己投票");
		return;
	}

	if(sfkytp){
		var id=$("#p7_id").val();
		
		var url = encodeURI(encodeURI("index.do?method=sytp&id=" + id+"&openid="+openid));
		$.ajax({
			type : "POST",
			url : url,
			dataType : "json",
			success : function(data) {

				if(data.tp){
					alert("恭喜您投票成功！");
					
				}else{
					alert("每日只能投票一次！");
				}
			}
		});
	}else{
		$("#p5").show();
	}
	
};



//首页投票按钮
function fntp(id,xxopenid,openid){
	openid=$("#openid").val();

	if(xxopenid==openid){
		alert("不能给自己投票");
		return;
	}
	if(sfkytp){
		var url = encodeURI(encodeURI("index.do?method=sytp&id=" + id+"&openid="+openid));
		$.ajax({
			type : "POST",
			url : url,
			dataType : "json",
			success : function(data) {

				if(data.tp){
					alert("恭喜您投票成功！");
					$("#queryform").submit();
				}else{
					alert("每日只能投票一次！");
				}
			}
		});
	}else{
		$("#p5").show();
		$("#xs_info").hide();
	}
}
</script>
    <script type="text/javascript">
    	var a=window.parent.innerWidth;
    	var b=(a/640);

    	$("#bg1_1_1").css("zoom",b);
    	
    var ss=0;
    var startY=0;
    var endY=0;
    $(document).bind("touchstart",function(e){
		var d=$("#xsxx").css("top");
		ss= parseFloat($("#xsxx").css("top"));
		
		startY=e.originalEvent.touches[0].clientY;
	});
	
	$(document).bind("touchmove",function(e){
		endY=e.originalEvent.touches[0].clientY;
		e.preventDefault();
		
		var delta = endY-startY;
		var curY = ss + delta;
		
		var h= parseFloat($("#xsxx").outerHeight());
		var h2=window.parent.innerHeight/b;

		
		if(curY > 0) curY = 0;
		if(curY < h2 - h) curY = h2 - h;
		
		$("#xsxx").css("top",curY+"px");
		
		
	});

</script>
<!-- </div>
</div> -->
</body>
</html>
