// JavaScript Document


$(function(){  
  show("news");
  show_nocontent("battle");
  
  var topbtn = $("#btn");
  var timer = null;
  var pagelookheight = $(window).height(); //可视范围内页面的大小
  //滚动条触发事件
  $(window).scroll(function(){
	  var backtop = $(document).scrollTop();//页面距顶部的大小（页面被隐藏的部分超出容器的距离）
	  if(backtop >=40){   //超出一屏幕的内容时出现返回到顶部的按钮
		 // $(".header").addClass("fixed");
		  topbtn.show();
	  }else{
		  //$(".header").removeClass("fixed");
		  topbtn.hide();
	  }
  });
  //返回顶部按钮
  topbtn.click(function () {
	  timer = setInterval(function () {   //计时器
		  var backtop = $(document).scrollTop();
		  var speedtop = backtop/5;
		  var heihgt=backtop -speedtop;  //浏览器卷去页面的高度
		  $(document).scrollTop(heihgt);
		  if(backtop ==0){
			  clearInterval(timer);
		  }
	  }, 30);
  });

  //猜涨停弹出窗
  $("#guess_btn").click(function(){
		 loadmask(true);
		 $(".guess1").show();
		 show("all_guess ");
		 $(".all_guess .tab_title li").removeClass("onthis");
		 $(".all_guess .tab_content .li").css("display","none")
		 $(".guess_btn1").click(function(){  //猜大盘按钮
		 	 $(".guess1").hide();
			 $(".all_guess .tab_title li").eq(0).addClass("onthis");
		 	 $(".all_guess .tab_content .li").eq(0).css("display","block");
			 $(".guess2").show();
		});
		 $(".guess_btn2").click(function(){  //猜个股按钮
		 	 $(".guess1").hide();
			 $(".all_guess .tab_title li").eq(1).addClass("onthis");
		 	 $(".all_guess .tab_content .li").eq(1).css("display","block");
			 $(".guess2").show();
		});
		$(".center .guessCon .close").click(function(){
			loadmask(false);	
		})
		$(".btn_tls").click(function(){
			 $(".all_guess .tab_title li").removeClass("onthis");
			 $(".all_guess .tab_title li").eq(2).addClass("onthis");
		 	 $(".all_guess .tab_content .li").eq(2).css("display","block");
		})
  });
  
  	$(window.document).scroll(function () {
		if($(document).scrollTop() > 1){
			$(".head_top").css("opacity",0.95);
			$(".top_center").css("opacity",0.95);
		}else{
			$(".head_top").css("opacity",1);
			$(".top_center").css("opacity",1);
		}
	});
	
  //众筹跟投页面
 // show2("");
 chips();
show2("shoyi");
  
  //众筹跟投页面倒计时
  show_tz();
  
  //金融超市兑换产品图片切换
  if($(".fs_tp_show").length > 0){
	  jQuery(".finanSlide").slide({mainCell:".fs_tp_show",titCell:".fs_li_show li"});
  }
  //金融超市立即兑换按钮
  $("#err_1").click(function(){
		$("#cb").checked=false;
		$(".fs_tcc").hide();
		$("html").css("overflow-y","scroll");
		$("#loadingss").animate({opacity:0},500,function(){
			$("#loadingss").remove();
		});
	  });
	$("#tj1").click(function(e) {
		var loads = '<div id="loadingss" style="width:100%; position:absolute; left:0; top:0; background:#000 no-repeat center center;"></div>';
		$("body").append(loads);
		$("#loadingss").height($("html").height());
		$("#loadingss").css({opacity:0,"z-index":999});
		$("#loadingss").animate({opacity:0.6},500);
		$("html").css("overflow","hidden");
		$(".fs_tcc").show();
		if($("#cb").is(':checked') ==false)
			{
				$("#tj2").attr({"disabled":"disabled"});	
			}
	});
	
	//金融超市选项卡
	show4();
	
	//自选股-锦囊
	show_jn();
	
	//筛选标题切换
	qiehuan();
	
	//众筹跟投页面条件选择
	choose();

	$(".openframe").click(function(){
		var he = $(this).attr("alt");
		if(!he) he = 200;
		openwindow($(this).attr("href"),he);
		return false;
	});
	
	$(".openframe40").click(function(){
		var he = $(this).attr("alt");
		if(!he) he = 200;
		openwindow($(this).attr("href"),he,"40%","30%");
		return false;
	});
	
	//2、查个股搜索
	if($(".ser_text").length > 0){ 
		$(".ser_text").bind("input propertychange",function(){
			var searchex = null;
			if($(".ser_text").val().length > 0){
				searchex = $(".ser_text").val();
				showfun(searchex);
			}
		  	
			function showfun(code){
		  		if(zidian == null){
			  		var urlStr="zidian.json";
			  		$.ajax({
			    		url:"zidian.json",//通用获取信息的servlet
			    		data:{"url":urlStr},//根据传入的urlStr返回服务器上的信息
			    		dataType:'json',
			    		type:'post',
			    		success:function(data){
			    			//alert(JSON.stringify(data));
			      			if(data.errorCode != 0){
								trace("系统暂忙！");
							}else{
								zidian = data.zidian;
								showlist();
							}
			    		},
			    		error:function(data){
			    			alert(JSON.stringify(data));
			    		}
			  		});
		  		}else{
		  			showlist();
		  		}
	  		}
	  		
	  		function showlist(){
	  			var endstr = [];
	  			var endmax = 0;
	  			var types = "";
	  			if(!isNaN(searchex)){
	  				types = "num";
	  			}else{
	  				types = "tex";
	  			}
	  			for(var i = 0; i < zidian.length; i++){
	  				if(types == "num"){
	  					if(searchex == zidian[i].code.substr(0,searchex.length)){
	  						endstr.push(zidian[i]);
	  						endmax = endmax + 1;
	  					}
	  					if(endmax >= 6){
	  						break;
	  					}
	  				}
	  			}
	  			showweb(endstr,types);
	  		}
	  		
	  		function showweb(code,types){
	  			if(code.length > 0){
	  				$(".ser_list").show();
	  			}else{
	  				$(".ser_list").hide();
	  			}
	  			var str = "";
	  			var tstr = "";
	  			for(var l = 0; l < code.length; l++){
	  				if(types == "num"){
	  					tstr = "<b>" + code[l].code.substr(0,searchex.length) + "</b>" + code[l].code.substr(searchex.length,code[l].code.length);
	  					str = str + "<div class='cont' title='"+code[l].code+"'><font>"+code[l].name+"</font>"+tstr+"</div>";
	  				}else{
	  					tstr = "<b>" + code[l].name.substr(0,searchex.length) + "</b>" + code[l].name.substr(searchex.length,code[l].name.length);
	  					str = str + "<div class='cont' title='"+code[l].code+"'><font>"+code[l].code+"</font>"+tstr+"</div>";
	  				}
	  			}
	  			$(".ser_list").html(str);
	  			
	  			$(".cont").click(function(){
	  				window.open("buy.oneclass.jsp?c=" + $(this).attr("title"));
	  				$(".ser_text").val("");
	  			});
	  		}
		});
		  
		$(".ser_text").blur(function(){
			closer = setTimeout("hidelist()",200);
		});
	}
	
	//大行情接口===========================================================
	var minsloaded = 0;
	function getmins(type,box,classs){
		//alert(type);
		$.get("servlet/HQGeter?u="+type,function (data){
			//alert(JSON.stringify(data));
			if(data){
				if(data.errorCode!=0){
					trace(data.errorMsg);
					$(box).html("行情数据加载失败！");
				}else{
					minsloaded = minsloaded + 1;
					var endStr = "";
					for(var i=0;i<data.content.length;i++){
						endStr += "<a href='buy.mins.jsp?id="+data.content[i].url+"&name=" + data.content[i].name + "&co="+data.content[i].color+"' class='"+classs+"'>" + data.content[i].name + "</a>:&nbsp;&nbsp;<span class='"+data.content[i].color+"'>"+data.content[i].point+"&nbsp;&nbsp;"+data.content[i].uanddx+"&nbsp;&nbsp;"+data.content[i].uanddp+"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"; 
					}
					if($("#"+box).html() == "loading..."){
						$("#"+box).html(endStr);
					}else{
						$("#"+box).append(endStr);
					}
					
					if(minsloaded == 3){
						var Marquee1 = new Marquee(box);
						Marquee1.Direction = "left";
						Marquee1.Step = 1;
						Marquee1.Width = 1080;
						Marquee1.Height = 45;
						Marquee1.Timer = 20;
						Marquee1.DelayTime = 0;
						Marquee1.WaitTime = 0;
						Marquee1.ScrollStep = 0;
						Marquee1.Start();
					}
					
					$("."+classs).click(function(){
						var he = 400;
						openwindow($(this).attr("href"),he,"60%","20%");
						return false;
					});
				}	
			}else{
				$("#"+box).html("远程行情数据无法获取，请稍后再试！");
			}
		},'json',false);
	}
	
	if($("#runa").length > 0){
		getmins("yt","runa","openframea");
		getmins("oz","runa","openframeb");
		getmins("mz","runa","openframeb");
	}
});
var infoobj = {};
var gametype = 0;
var infsjid = null;

function getgameinf(callback){
	var urlStr = "getYhSjsInfo";
	$.ajax({
		url:'servlet/dynamicGenericGtl',
		data:{'url':urlStr},
		dataType:'json',
		type:'post',
		success:function(data){
			//alert(JSON.stringify(data));
			if(data.errorCode != 0){
				
			}else{
				if(data.dqBmsjs != ""){
					//$(".tmytab_title").html("<li class=\"onthis\" style=\"width:49%;\">模拟自玩</li><li style=\"width:49%;\">我的比赛</li>");
					infsjid = data.dqBmsjs;
					
					$.get("servlet/dynamicGenericGtl?url=" +escape("mnSjZdList&page=1"),function (datas){
						//alert(JSON.stringify(datas));
						if(datas){
							if(datas.errorCode == 0){
								var puted = false;
								for(var i = 0; i < datas.rows.length; i++){
									if(datas.rows[i].id == data.dqBmsjs){
										$(".tmytab_title").html("<li class=\"onthis\" style=\"width:50%;\">模拟自玩</li><li style=\"width:49.5%;\">"+datas.rows[i].sjName+"</li>");
										puted = true;
										callback();
										break;
									}
								}
								if(!puted) $(".tmytab_title").html("<li class=\"onthis\" style=\"width:100%;\">模拟自玩</li>");
							}else{
								$(".tmytab_title").html("<li class=\"onthis\" style=\"width:100%;\">模拟自玩</li>");
							}
						}else{
							$(".tmytab_title").html("<li class=\"onthis\" style=\"width:100%;\">模拟自玩</li>");
						}
					},"json",false);
					
				}else{
					$(".tmytab_title").html("<li class=\"onthis\" style=\"width:100%;\">模拟自玩</li>");
				}
			}
		}
	},"json",false);
}

function getzc(num){
	//alert(num);
	var urlStr = "cczcInfo";
	urlStr += "&mrlx="+num;
	if(num == 1){
		urlStr += "&sjid=" + infsjid;
	}
	$.ajax({
		url:'servlet/dynamicGenericGtl',
		data:{'url':urlStr},
		dataType:'json',
		type:'post',
		success:function(data){
			//alert(JSON.stringify(data));
			if(data){
				if(data.errorCode != 0){
					trace(data.errorMsg);
				}else{
					infoobj.kyzc = data.kyzc;
					infoobj.ylv = (data.ylv) ? data.ylv : "0.0";
					infoobj.ysy = (data.ysy) ? data.ysy : "0.0";
					infoobj.zsy = (data.zsy) ? data.zsy : "0.0";
					infoobj.zsz = data.zsz;
					infoobj.pm = data.pm;
					getcc(num);
				}
			}
		}
	});
}

function getcc(num){
	//alert(num);
	var urlStr = "gpccList";
	urlStr += "&mrlx="+num;
	if(num == 1){
		urlStr += "&sjid=" + infsjid;
	}
	$.ajax({
		url:'servlet/dynamicGenericGtl',
		data:{'url':urlStr},
		dataType:'json',
		type:'post',
		success:function(data){
			//alert(JSON.stringify(data));
			if(data){
				if(data.errorCode == 0){
					var namebase = "";
					for(var i = 0; i < data.rows.length; i++){
						namebase += (namebase == "") ? data.rows[i].zqdm : "," + data.rows[i].zqdm;
					}
					if(namebase != ""){
						getnowprice(namebase,data);
					}else{
						$(".kyzc").html(Number(infoobj.kyzc).toFixed(2));
						if($(".ylv").hasClass("r_")){
							$(".ylv").removeClass("r_");
						}
						if($(".ylv").hasClass("g_")){
							$(".ylv").removeClass("g_");
						}
						if($(".ylv").hasClass("d_")){
							$(".ylv").removeClass("d_");
						}
						$(".ylv").addClass((Number(infoobj.ylv) >= 0) ? "r_" : "g_");
						$(".ylv").html(infoobj.ylv);
						$(".zsz").html(Number(infoobj.zsz).toFixed(2));
						if($(".zsy").hasClass("r_")){
							$(".zsy").removeClass("r_");
						}
						if($(".zsy").hasClass("g_")){
							$(".zsy").removeClass("g_");
						}
						if($(".zsy").hasClass("d_")){
							$(".zsy").removeClass("d_");
						}
						$(".zsy").addClass((Number(infoobj.zsy) >= 0) ? "r_" : "g_");
						$(".zsy").html(infoobj.zsy);
						if($(".ysy").hasClass("r_")){
							$(".ysy").removeClass("r_");
						}
						if($(".ysy").hasClass("g_")){
							$(".ysy").removeClass("g_");
						}
						if($(".ysy").hasClass("d_")){
							$(".ysy").removeClass("d_");
						}
						$(".ysy").addClass((Number(infoobj.ysy) >= 0) ? "r_" : "g_");
						$(".ysy").html(infoobj.ysy);
						$(".zzc").html((Number(infoobj.kyzc) + Number(infoobj.zsz)).toFixed(2));
					}
				}else{
					$(".kyzc").html(Number(infoobj.kyzc).toFixed(2));
					if($(".ylv").hasClass("r_")){
						$(".ylv").removeClass("r_");
					}
					if($(".ylv").hasClass("g_")){
						$(".ylv").removeClass("g_");
					}
					if($(".ylv").hasClass("d_")){
						$(".ylv").removeClass("d_");
					}
					$(".ylv").addClass((Number(infoobj.ylv) >= 0) ? "r_" : "g_");
					$(".ylv").html(infoobj.ylv);
					$(".zsz").html(Number(infoobj.zsz).toFixed(2));
					if($(".zsy").hasClass("r_")){
						$(".zsy").removeClass("r_");
					}
					if($(".zsy").hasClass("g_")){
						$(".zsy").removeClass("g_");
					}
					if($(".zsy").hasClass("d_")){
						$(".zsy").removeClass("d_");
					}
					$(".zsy").addClass((Number(infoobj.zsy) >= 0) ? "r_" : "g_");
					$(".zsy").html(infoobj.zsy);
					if($(".ysy").hasClass("r_")){
						$(".ysy").removeClass("r_");
					}
					if($(".ysy").hasClass("g_")){
						$(".ysy").removeClass("g_");
					}
					if($(".ysy").hasClass("d_")){
						$(".ysy").removeClass("d_");
					}
					$(".ysy").addClass((Number(infoobj.ysy) >= 0) ? "r_" : "g_");
					$(".ysy").html(infoobj.ysy);
					$(".zzc").html((Number(infoobj.kyzc) + Number(infoobj.zsz)).toFixed(2));
				}
			}else{
				
			}
		}
	});
}

function getnowprice(namebase,olddata){
	//alert(namebase.substr(2,6));
	$.ajax({
		url:"servlet/mostStockSearch",
		data:{"stocks":namebase},
		dataType:'json',
		type:'post',
		success:function(data){
			//alert(JSON.stringify(data));
			if(data){
				if(data.showapi_res_code == 0){
					//alert(JSON.stringify(olddata));
					
					var tempmark;
					var tempcode;
					var maxmoney = 0;
					for(var i = 0; i < olddata.rows.length; i++){
						tempmark = olddata.rows[i].zqdm.substr(0,2);
						tempcode = olddata.rows[i].zqdm.substr(2,6);
						
						for(var l = 0; l < data.showapi_res_body.list.length; l++){
							if(data.showapi_res_body.list[l].code == tempcode && data.showapi_res_body.list[l].market == tempmark){
								maxmoney = maxmoney + Number(olddata.rows[i].ccsl) * Number(data.showapi_res_body.list[l].nowPrice);
							}
						}
					}
					maxmoney = maxmoney.toFixed(2);
					
					$(".kyzc").html(Number(infoobj.kyzc).toFixed(2));
					var ylv = (Number(infoobj.kyzc) + Number(maxmoney) - 200000) / 200000;
					if($(".ylv").hasClass("r_")){
						$(".ylv").removeClass("r_");
					}
					if($(".ylv").hasClass("g_")){
						$(".ylv").removeClass("g_");
					}
					if($(".ylv").hasClass("d_")){
						$(".ylv").removeClass("d_");
					}
					$(".ylv").addClass((ylv >= 0) ? "r_" : "g_");
					$(".ylv").html(ylv.toFixed(2));
					$(".zsz").html(Number(Number(maxmoney)).toFixed(2));
					if($(".zsy").hasClass("r_")){
						$(".zsy").removeClass("r_");
					}
					if($(".zsy").hasClass("g_")){
						$(".zsy").removeClass("g_");
					}
					if($(".zsy").hasClass("d_")){
						$(".zsy").removeClass("d_");
					}
					$(".zsy").addClass((Number(infoobj.zsy) >= 0) ? "r_" : "g_");
					$(".zsy").html(infoobj.zsy);
					if($(".ysy").hasClass("r_")){
						$(".ysy").removeClass("r_");
					}
					if($(".ysy").hasClass("g_")){
						$(".ysy").removeClass("g_");
					}
					if($(".ysy").hasClass("d_")){
						$(".ysy").removeClass("d_");
					}
					$(".ysy").addClass((Number(infoobj.ysy) >= 0) ? "r_" : "g_");
					$(".ysy").html(infoobj.ysy);
					$(".zzc").html((Number(infoobj.kyzc) + Number(maxmoney)).toFixed(2));
				}
			}else{
				trace("行情数据获取出错，请稍后再试！");
			}
		}
	});
}

//关闭搜索条的list
function hidelist(){
  	$(".ser_list").hide();
}

//获取页面参数
function getQueryString(name) {
	var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
	var r = window.location.search.substr(1).match(reg);
	if (r!=null) return (r[2]); return null;
}
//返回百分比
function repants(str){
	if(str == "%") return "0%";
	var tnum = str.replace("%","");
	var endnum;
	if(!isNaN(tnum)){
		endnum = tnum + "%";
	}else{
		endnum = "0%";
	}
	return endnum;
}

//tab选项卡
function show(name){
	var titleName=$("."+name+" .tab_title li");
	var conName=$("."+name+" .tab_content .li");
	if(titleName.length !=conName.length){
		//alert(titleName.length+"  "+conName.length)
		return ;
	}
	for(var i=0;i<titleName.length;i++){
		$(titleName).eq(i).attr("id",i);
		$(titleName).eq(i).click(function(){
			for(var j=0;j<titleName.length;j++){
				$(titleName).eq(j).removeClass("onthis");
				$(conName).eq(j).css({"display":"none"});
			}
			$(this).addClass("onthis");
			$(conName).eq($(this).attr("id")).css("display","block");
		});
	}	
}
//tab选项卡
function show_nocontent(name){
	  var titleName=$("."+name+" .tab_title li");
	  var conName=$("."+name+" .tab_content .li");
	  if(titleName.length !=conName.length){
		  //alert(titleName.length+"  "+conName.length)
		  return ;
	  }
	  for(var i=0;i<titleName.length;i++){
		  $(titleName).eq(i).attr("id",i);
		  $(titleName).eq(i).click(function(){
			  for(var j=0;j<titleName.length;j++){
				  $(titleName).eq(j).removeClass("onthis");
				  $(conName).eq(j).css({"display":"none"});
			  }
			  $(this).addClass("onthis");
			  $(conName).eq($(this).attr("id")).css("display","block");
		  });
	  }	
}

//众筹跟投页面选项卡
function show2(name){
  var titleName=$("."+name+" .cmi_lsame li");
 /* var conName=$("."+name+" .cmiddle_right .Con");
  if(titleName.length !=conName.length){
	  alert(titleName.length+"  "+conName.length)
	  return ;
  }*/
  for(var i=0;i<titleName.length;i++){
	  //$(titleName).eq(i).attr("id",i);
	  $(titleName).eq(i).click(function(){
		  for(var j=0;j<titleName.length;j++){
			  $(titleName).eq(j).removeClass("cmiddle_on");
			 // $(conName).eq(j).css({"display":"none"});
		  }
		  $(this).addClass("cmiddle_on");
		 // $(conName).eq($(this).attr("id")).css("display","block");
	  });
  }	
}


function show4(){
	var xq1=$("#xq1");
	var xq2=$("#xq2");
	var xqs1=$("#xqs_1");
	var pj=$("#pj");
	var xq_help=$("#xq_help");
	var pj_help=$("#pj_help")
	xq1.bind("click",function(){
		xq2.removeClass("fs_no_active");
		pj_help.hide();
		xq_help.show();
		$(this).removeClass("fs_no_active");
		xq2.addClass("fs_no_active")
		xqs1.fadeIn(300);
		pj.fadeOut(50);
		})
	xq2.bind("click",function(){
		xq1.removeClass("fs_no_active");
		pj_help.show();
		xq_help.hide();
		$(this).removeClass("fs_no_active");
		xq1.addClass("fs_no_active");
		pj.fadeIn(300);
		xqs1.fadeOut(50);
		})	
	
}

//猜个股弹出窗
function loadmask(dos){
	if(dos){
		var loads = '<div id="loadingss" style="width:100%; position:absolute; left:0; top:0; background:url(images/loading1.gif) #000 no-repeat center center;"></div>';
		$("body").append(loads);
		$("#loadingss").height($("html").height());
		$("#loadingss").css({opacity:0,"z-index":999});
		$("#loadingss").animate({opacity:0.6},500);
		$(".guessCon").show();
	}else{
		$(".guessCon").hide();
		$("#loadingss").animate({opacity:0},500,function(){
			$("#loadingss").remove();
		});
	}
	//点击空白处关闭弹窗
	$("#loadingss").click(function(){
		$(".guess1").hide();
		$(".guess2").hide();
		$(".guessCon").hide();
		$("html").css("overflow-y","scroll");
		$("#loadingss").animate({opacity:0},500,function(){
			$("#loadingss").remove();
		});
		
	})	
}

//众筹跟投页面倒计时
function gettime(now,old){	
	var array=[];
	
	var cha=(old.getTime()-now.getTime())/1000;
	
	var days=parseInt(cha/(60*60*24));
		cha%=(60*60*24);
	array.push(days);	
	var hours=parseInt(cha/(60*60));
	cha%=(60*60);
	array.push(hours);	
	var minut=parseInt(cha/60);
	array.push(minut);	
	var sen=parseInt(cha%60);
	array.push(sen);	
	return  array;
}
function djs(){
	var spans=document.getElementById("_left_table").getElementsByTagName("span");
	var old=new Date();
	old.setFullYear(2015);
	old.setMonth(8);
	old.setDate(1);
	old.setHours(12);
	old.setMinutes(0);
	old.setSeconds(0);
	var now=new Date();		
	for(var i=0;i<gettime(now,old).length;i++){
		spans[i].innerHTML=gettime(now,old)[i];
	}
	
	setInterval(function(){
		var now=new Date();		
		for(var i=0;i<gettime(now,old).length;i++){
			spans[i].innerHTML=gettime(now,old)[i];
			
			
			}
		},1000)
}

/*投资计划tab选项卡*/
function show_tz(){
	var oLi=$("._left_top_ul li");
	var oUl=$("._left_bottom ul");

	for(var i = 0; i < oLi.length; i++){
		oLi[i].index = i;
		oLi[i].onclick = function (){
			for(var n = 0;n < oLi.length;n++){
				oLi[n].className = "";
				this.className = "_left_top_li";
			}
			for(var n = 0;n <oUl.length;n++){
				oUl[n].style.display = "none";
				oUl[this.index].style.display="block";
			  
			}
		}
	}	
}
//自选股买卖-锦囊
function show_jn(){
	var oLi=$(".combat03_left_bottom_right_ul li");
	var oUl=$(".combat03_left_bottom_right_x ul");
	  for(var i = 0; i < oLi.length; i++)
	  {
		  oLi[i].index = i;
		  oLi[i].onclick = function (){
			  for(var n = 0;n < oLi.length;n++)
			  {
				  oLi[n].className = "";
				  this.className = "combat03_left_bottom_right_li";
			  }
				  for(var n = 0;n <oUl.length;n++)
				  {
					  oUl[n].style.display = "none";
					  oUl[this.index].style.display="block";
					
				  }
		  }
	  }	
}

//牛人排行选项卡
function show_np(){
	var oLi=$(".01_left_ul li");
	for(var i = 0; i < oLi.length; i++){
		oLi[i].index = i;
		oLi[i].onclick = function (){
			for(var n = 0;n < oLi.length;n++){
				oLi[n].className = "";
				this.className = "01_left_top_li";
			}
		}
	}	
}

//筛选标题切换
function qiehuan(){
	var eles=$("#title_active li");
	for(var i=0;i<eles.length;i++){
		$(eles).eq(i).click(function(){
			for(var j=0;j<eles.length;j++){
				$(eles).eq(j).removeClass("on_stock");
			}
			$(this).addClass("on_stock")	
		})	
	}	
}

//众筹跟投页面条件选择
function choose(){
	$(".choose_tbn td.tj").each(function(){
		$(this).click(function(){
			var parEle=$(this).parent();
			$(parEle).children("td.tj").removeClass("ccmiddle_middle_td");
			$(this).addClass("ccmiddle_middle_td");
			
		})	
	})	
}

//清楚html代码
function delHtmlTag(str,len){
	if(str){
		var endstr = str.replace(/&lt;/g,"<");
		endstr = endstr.replace(/&gt;/g,">");
		endstr = endstr.replace(/<[^>]+>/g,"");
		endstr = endstr.replace(/　/g,"");
		
		if(len){
			if(endstr.length > len){
				endstr = endstr.substr(0,len)+"...";
			}
		}
		return endstr;
	}else{
		return "";
	}
}

//弹出框口
function alertBox(ele){
	var bh = $("body").height();
	var bw =$("body").width();
	var fullbg=$('<div id="fullbg"></div>')
	$("body").prepend(fullbg);
	$("#fullbg").css({
		height:bh,
		width:bw,
		display:"block"
	});
	alertBox_position(ele);
	$(ele).show();	
}
//关闭弹出框口
function close_alertBox(ele){
  $("#fullbg,"+ele+"").hide();
}

//弹出窗口的位置
function alertBox_position(ele){
	var boxWidth,boxHeight;
	//弹出框是否显示
	marginLeft=$(ele).width()/2;
	marginTop=$(ele).height()/2;
	mar="-"+ marginTop + "px 0 0 -" + marginLeft +"px";
	$(ele).css({margin:mar});
}	
//错误信息提示框		
//错误信息提示框		
function trace(str,callback,btn,width){
	var loads = '<div id="tracebg" style="width:100%; position:absolute; left:0; top:0; background:#000;"></div><div id="tracebox" style="width:'+width+'%; position:absolute; left:'+(100-width)/2+'%; margin-top:'+($(window).height()*0.1)+'px; background:#fff; border-radius:8px; padding:3em 1% 1% 1%; text-align:center; font-size:1em; color:#333;">'+str+'<br><br><br>';
	if(btn && btn.length > 0){
		var len = 100 / btn.length - 1;
		var fw = "";
		for(var i = 0; i < btn.length; i++){
			if(i >= 2) break;
			if(i == 1) fw = "border-left:1px solid #efefef;";
			loads += '<font style="width:'+len+'%; display:block; float:left; line-height:35px; border-bottom-right-radius:5px; border-bottom-left-radius:5px; color:#0073d1; border-top:1px solid #efefef;'+fw+'" class="tracebtn">'+btn[i].name+'</font>';
		}
	}else{
		loads += '<font style="width:100%; display:block; line-height:35px; margin:0 auto; border-radius:5px; color:#CC0000; border-top:1px solid #efefef; cursor:pointer;" class="tracebtn tbtn">知道了</font>';
	}
	loads += '</div>';
	
	$("body").append(loads);
	$("#tracebg").height($(document).height());
	$("#tracebg").css({opacity:0,"z-index":999999});
	
	//scrollTop
	$("#tracebox").css({opacity:0,"z-index":1000000,top:($(window).width()*0.08+$(window).scrollTop())+"px"});
	$("#tracebg").animate({opacity:0.6},200,function(){
		$("#tracebox").animate({opacity:0.95},200);
	});
	
	$(".tracebtn").click(function(){
		var names = $(this).html();
		if(btn){
			for(var l = 0; l < btn.length; l++){
				if(btn[l].name == names){
					if(btn[l].fun){
						$("#tracebox").animate({opacity:0},200,function(){	  
							$("#tracebg").animate({opacity:0},200,function(){
								$("#tracebg").remove();
								$("#tracebox").remove();
								if(callback) callback();
							});
						});
					}else{
						$("#tracebox").animate({opacity:0},200,function(){	  
							$("#tracebg").animate({opacity:0},200,function(){
								$("#tracebg").remove();
								$("#tracebox").remove();
							});
						});
					}
				}
			}
		}else{
			$("#tracebox").animate({opacity:0},500,function(){	  
				$("#tracebg").animate({opacity:0},500,function(){
					$("#tracebg").remove();
					$("#tracebox").remove();
					if(callback) callback();
				});
			});
		}
	});
}

function textbox(cont,backstr,widths){
	var width,left;
	if(!widths){
		width = "30%";
		left = "35%";
	}else{
		width = widths + "%";
		left = ((100 - widths) / 2) + "%";
	}
	var loads = '<div id="textbg" style="width:100%; position:absolute; left:0; top:0; background:#000;"></div><div id="textbox" style="width:'+width+'; position:absolute; margin-left:'+left+'; margin-top:'+($(window).height()*0.1)+'px; background:#fff; border-radius:8px; padding:3em 1% 1% 1%; text-align:center; font-size:1em; color:#333;">';
	loads += cont + '<br/>';
	loads += '<textarea rows="4" class="textboxcont"></textarea><br>';
	loads += '<font style="width:50%; float:left; display:block; line-height:35px; margin:0 auto; border-radius:5px; color:#CC0000; border-top:1px solid #efefef; cursor:pointer;" class="sendbtn tbtn">提交</font>';
	loads += '<font style="width:50%; float:left; display:block; line-height:35px; margin:0 auto; border-radius:5px; color:#CC0000; border-top:1px solid #efefef; cursor:pointer;" class="closebtn tbtn">取消</font>';
	loads += '</div>';
	
	//$("body").addClass("bodyhide");
	$("body").append(loads);
	$("#textbg").height($(document).height());
	$("#textbg").css({opacity:0,"z-index":999999});
	
	//scrollTop
	//alert($(window).height());
	$("#textbox").css({opacity:0,"z-index":1000000,top:($(window).width()*0.08+$(window).scrollTop())+"px"});
	$("#textbg").animate({opacity:0.6},200,function(){
		$("#textbox").animate({opacity:0.95},200);
	});
	
	$(".sendbtn").click(function(){
		$("#textbox").animate({opacity:0},500,function(){	  
			$("#textbg").animate({opacity:0},500,function(){
				if(backstr) backstr($(".textboxcont").val());
				$("#textbg").remove();
				$("#textbox").remove();
				//$("body").removeClass("bodyhide");
			});
		});
	});
	$(".closebtn").click(function(){
		$("#textbox").animate({opacity:0},500,function(){	  
			$("#textbg").animate({opacity:0},500,function(){
				$("#textbg").remove();
				$("#textbox").remove();
				//$("body").removeClass("bodyhide");
			});
		});
	});
}

function openwindow(url,height,widths,lefts){
	var width = "20%";
	var left = "40%";
	if(widths) width = widths;
	if(lefts) left = lefts;
	var loads = '<div id="framebg" style="width:100%; position:absolute; left:0; top:0; background:#000;"></div><div id="framebox" style="width:'+width+'; position:absolute; left:'+left+'; margin-top:'+($(window).height()*0.1)+'px; background:#fff; border-radius:8px; padding:3em 1% 1% 1%; text-align:center; font-size:1em; color:#333;">';
	loads += '<iframe src="'+url+'" width="100%" height="'+height+'" frameborder="no" border="0" scrolling="no"></iframe><br>';
	loads += '<font style="width:100%; display:block; line-height:35px; margin:0 auto; border-radius:5px; color:#CC0000; border-top:1px solid #efefef; cursor:pointer;" class="framebtn tbtn">关闭窗口</font>';
	loads += '</div>';
	
	//$("body").addClass("bodyhide");
	$("body").append(loads);
	$("#framebg").height($(document).height());
	$("#framebg").css({opacity:0,"z-index":999999});
	
	//scrollTop
	//alert($(window).height());
	$("#framebox").css({opacity:0,"z-index":1000000,top:($(window).width()*0.08+$(window).scrollTop())+"px"});
	$("#framebg").animate({opacity:0.6},200,function(){
		$("#framebox").animate({opacity:0.95},200);
	});
	
	$(".framebtn").click(function(){
		$("#framebox").animate({opacity:0},500,function(){	  
			$("#framebg").animate({opacity:0},500,function(){
				$("#framebg").remove();
				$("#framebox").remove();
				//$("body").removeClass("bodyhide");
			});
		});
	});
}

function closewindow(fs){
	$("#"+fs+"box").animate({opacity:0},500,function(){	  
		$("#"+fs+"bg").animate({opacity:0},500,function(){
			$("#"+fs+"bg").remove();
			$("#"+fs+"box").remove();
			//$("body").removeClass("bodyhide");
		});
	});
}

function chips(){
	$(".cmiddle .cmiddle_left li").eq(0).addClass("cmiddle_on")
	$(".chips .cmiddle_right .chipsCon").eq(0).css("display","block");
	$(".cmiddle .cmiddle_left li").each(function(index){
		$(this).click(function(){
			$(this).siblings().removeClass("cmiddle_on");
			$(this).addClass("cmiddle_on");
			if(index!=0){
				$(".chips .cmiddle_right .chipsCon").css("display","none");
				$(".chips .cmiddle_right .chipsCon").eq(1).css("display","block");
			}else{
				$(".chips .cmiddle_right .chipsCon").css("display","none");
				$(".chips .cmiddle_right .chipsCon").eq(0).css("display","block");
			}
		});
		
	})	
}

function getCharFromUtf8(str) {  
    var cstr = "";  
    var nOffset = 0;  
    if (str == "")  
        return "";  
    str = str.toLowerCase();  
    nOffset = str.indexOf("%e");  
    if (nOffset == -1)  
        return str;  
    while (nOffset != -1) {  
        cstr += str.substr(0, nOffset);  
        str = str.substr(nOffset, str.length - nOffset);  
        if (str == "" || str.length < 9)  
            return cstr;  
        cstr += utf8ToChar(str.substr(0, 9));  
        str = str.substr(9, str.length - 9);  
        nOffset = str.indexOf("%e");  
    }  
    return cstr + str;  
}

function utf8ToChar(str) {  
    var iCode, iCode1, iCode2;  
    iCode = parseInt("0x" + str.substr(1, 2));  
    iCode1 = parseInt("0x" + str.substr(4, 2));  
    iCode2 = parseInt("0x" + str.substr(7, 2));  
    return String.fromCharCode(((iCode & 0x0F) << 12) | ((iCode1 & 0x3F) << 6) | (iCode2 & 0x3F));  
}

function rehtml(con){
	var endstr = con;
	endstr = endstr.replace(/\&lt;/g, "<");
	endstr = endstr.replace(/\&gt;/g, ">");
	endstr = endstr.replace(/\&amp;/g, "&");
	endstr = endstr.replace(/\&quot;/g, "\"");
	//endstr = endstr.replace("http://127.0.0.1:8080","http://admin.gtl666.com");
	//alert(endstr);
	return endstr;
}

function ubb2html(val){
	val = val.replace(/\[img]([^\[\]]*)\[\/img\]/ig, "<img src=\"$1\"/>");
    val = val.replace(/\[b\]([^\[\]]*)\[\/b\]/ig, "<b>$1</b>");
    val = val.replace(/\[p\]([^\[\]]*)\[\/p\]/ig, "<p>$1</p>");
    val = val.replace(/\[strong\]([^\[\]]*)\[\/strong\]/ig, "<strong>$1</strong>");
    val = val.replace(/\[color=([^\[\]]*)\]([^\[\]]*)\[\/color\]/ig, "<font color='$1'>$2</font>");
    val = val.replace(/\[i\]([^\[\]]*)\[\/i\]/ig, "<i>$1</i>");
    val = val.replace(/\[a href=\"?([^ \'\"\[\]]*)\"?\]([^\[\]]*)\[\/a\]/ig, "<a href=\"$1\" target=\"_blank\">$2</a>");
    val = val.replace(/\[hilitecolor=([^\[\]]*)\]([^\[\]]*)\[\/hilitecolor\]/ig, "<span>$2</span>");
    return val;
}

function bindTabselect(obj,callback){
	var long = $(obj).width();
	var max = $(obj).children("div").length;
	if(max < 1) return;
	
	$(obj + " div:eq(0)").css({"width":String(parseInt(long / max)) + "px"});
	$(obj + " div:eq(0)").addClass("on");
	$(obj + " div:eq(0)").addClass("f");
	$(obj + " div:eq(" + String(max-1) + ")").addClass("e");
	for(var i = 1; i < max; i++){
		//alert(String(parseInt(long / max)));
		$(obj + " div:eq(" + i + ")").css({"width":String(parseInt(long / max) - 3) + "px","border-left":"1px solid #e34814"});
	}
	
	$(obj + " div").click(function(){
		for(var i = 0; i < max; i++){
			//alert(String(parseInt(long / max)));
			if($(obj + " div:eq(" + i + ")").hasClass("on")){
				$(obj + " div:eq(" + i + ")").removeClass("on");
			}
		}
		$(this).addClass("on");
		if(callback){
			callback($(this).attr("alt"));
		}
	});
}