<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
(function(){
var phoneWidth = parseInt(window.screen.width), phoneScale = phoneWidth/320, ua = navigator.userAgent;
if (/Android (\d+\.\d+)/.test(ua)){
	var version = parseFloat(RegExp.$1);
	if(version > 2.3){
		document.write('<meta name="viewport" content="width=320, initial-scale=1, user-scalable=0">');
	}else{
		document.write('<meta name="viewport" content="width=320, target-densitydpi=device-dpi">');
	}
// 其他系统
} else {
	document.write('<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">');
}
})();
</script>
<style type="text/css">
body{ width:100%; height:100%; margin:0; padding:0; color:#000; background:#f7f7f7; width:100%; cursor:default; font-family: 'Microsoft yahei';}
.loads{ width:100%; min-height:200px; height:100%; background:url(${htmlPath}images/loading.gif) no-repeat center center;}
#newcont	{ width:92%; height:100%; margin:0 auto;}
h2{ width:100%; padding:10px 0 0 0; font-size:20px; text-align:center; display:block;}
h6{ width:100%; height:30px; font-size:10px; border-bottom:1px solid #efefef; padding-bottom:5px; text-align:center; display:block; font-weight:normal; color:#666;}
h5{ width:100%; font-weight:normal; font-size:14px; overflow:hide;}
h5 img	{ width:100%;}
.imgbox	{ width:100%; height:100px; margin:0; padding:0 0 10px 0;}
.imgbox img	{ width:55%; height:80px; background:#fff; padding:4px; margin:0 1%; border:1px solid #efefef; float:left;}
.header	{ width:100%; height:100px; background:#fff; color:#666; font-size:10px; display:none;}
.header img	{ margin:20px; float:left;}
.header div	{ float:left; line-height:20px; margin:20px 0 0 0;}
.header div b	{ font-size:16px; color:#000;}
.header a	{ float:right; padding:10px 20px; border:1px solid #e2e2e2; color:#e34814; text-decoration:none; font-size:14px; font-weight:bold; margin:30px 20px 0 0; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px;}
.good{ line-height:30px; height:30px; color:#999; font-size:13px; font-weight:normal; padding:6px 8px; margin:15px 0 0 5px; border:1px solid #efefef; display:inline; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; background:#fff;}
.good:hover{background:#efefef;}
.good img{margin:-4px 0 0 0;}
.good span	{ color:#CC0000;}
.dasangbox	{ width:96%; margin:0 auto; padding:20px 2%; border-top:1px solid #efefef; background:#fff;}
.dasangbox .note { width:100%; color:#999; text-align:center; padding:20px 0 0 0;}
.dasang { width:50%; padding:4px 8px; margin:0 auto; border:1px solid #efefef; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; font-size:13px;}
.dasang:hover{background:#efefef;}
.pinlun	{ width:100%; margin:0 auto; padding:10px 0; border-top:1px solid #efefef; color:#999; font-size:13px; line-height:25px;}
.pinlun .plbox	{ width:96%; min-height:65px; margin:0 auto; padding:20px 2% 10px 2%; border-bottom:1px solid #efefef; border-top:1px solid #efefef; background:#fff;}
.pinlun .plbox .face	{ width:60px; height:60px; margin:0 10px 0 0; float:left; padding:5px; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; border:1px solid #f6f6f6; background:#fff;}
.pinlun .plbox b	{ color:#333;}
.pinlun .plbox .good{padding:2px 4px; margin:-5px 0 0 5px; border:1px solid #efefef; float:right; -moz-border-radius:5px; -webkit-border-radius:5px; border-radius:5px; background:#fff; font-size:12px;}
.pinlun .plbox .good:hover{background:#efefef;}
.pinlun .plbox .good img{margin:-4px 0 0 0;}
.pinlun .plplbox	{ width:100%; padding:0;}
.pinlun .plplcont	{ line-height:30px; background:#f7f7f7; padding:0 0 0 20%;}
.pinlun .plplcont b	{ color:#111;}
.pinlun .plplcont .red	{color:#cc0000;}
.textboxcont	{width:94%; height:90px; border:1px solid #efefef; margin:10px auto;}
.tbtn:hover	{background:#f7f7f7;}
img{max-width: 100%;}
</style>
<link href="${htmlPath}source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" rel="stylesheet" type="text/css"  />
<link href="${htmlPath}source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" media="screen" />
<title>股天乐 - 博文</title>
<script src="${htmlPath}js/jquery183.js" type="text/javascript"></script>
<script src="${htmlPath}js/jquery.SuperSlide.2.1.js" type="text/javascript"></script>
<script src="${htmlPath}js/effect.js" type="text/javascript"></script>
<script src="${htmlPath}js/queryString.js" type="text/javascript"></script>
<script src="${htmlPath}source/jquery.fancybox.js?v=2.1.5" type="text/javascript"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script type="text/javascript">
var shareData = {
	title: "股天乐最新信息",
	desc: "股天乐最新信息",
	link: window.location.href,
	imgUrl: "http://www.gtl666.com/images/gutl.png",
	type: "",
	dataUrl: "",
	success: function (res) { },
	cancel: function (res) { }
}

function callbacks(data){
        //alert(JSON.stringify(data));
	wx.config({
	    debug: false,
	    appId: data.appId,
	    timestamp: data.TimeStamp,
	    nonceStr: data.NonceStr,
	    signature: data.Signature,
	    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage']
	});
}

	wx.ready(function () {
		wx.onMenuShareTimeline({
			title: shareData.desc,
			link: shareData.link,
			imgUrl: shareData.imgUrl,
			success: shareData.success,
			cancel: shareData.cancel
		});

		wx.onMenuShareAppMessage({
			title: shareData.title,
			desc: shareData.desc,
			link: shareData.link,
			imgUrl: shareData.imgUrl,
			type: shareData.type,
			dataUrl: shareData.dataUrl,
			success: shareData.success,
			cancel: shareData.cancel
		});
	});

	var id = "${id}";
	var uid = "${uid}";
	var showDetail = "${showDetail}";
$(function(){
	var code_url = window.location.href;
    //code_url = encodeURIComponent(code_url);
    code_url = code_url.split('#')[0];
	
	//alert(code_url);
	
	$.ajax({
		type:"get", 
		data:{"jsonpcallback":"callbacks","apply_name":"gtl","apply_url":code_url}, 
		url:"http://gtlapi.wx.wauwo.net/api_jsapi/get_port.aspx", 
		dataType:"jsonp", 
		jsonp:"callback"
	});
	
		if(showDetail == 2){
		  trace("请先购买这篇文章！",null,null,80);
		  return;
		}
		if(showDetail == 0){
		  trace("这篇文章不见了！",null,null,80);
		  return;
		}
		$("#content").show();
		
		shareData.title = '${title }';
		shareData.desc = '${title }';
		shareData.link = window.location.href;
		$(".fancybox").fancybox();
		console.log($(".fancybox").length);
		$(".fancybox").each(function(index, ele){
			console.log(index);
			$(ele).fancybox();
		});
});

var iszaning = false;
function zan(){
	if(iszaning){
		return;
	}
	iszaning = true;
	$.ajax({
		url:"${basePath}api/bowen/zantuBowen",
		data:{bowenId:id,userId:uid,type:2},
		dataType:"json",
		type:"post",
		success:function(data){
			//var das = JSON.stringify(data);
			//alert(das);
			var obj = $(".good.wzgood").find("span.goodnum");
			if(data.success){
				obj.html(Number(obj.html())+1);
			}else{
				trace(data.errorMessage,null,null,80);
			}
			iszaning = false;
		},
		error:function(e){
			trace("系统错误，请稍后再试！");
			iszaning = false;
		}
	});
}

</script>
</head>

<body>
<div id="content" style="display: none;">
<div>
<div style="width: 40%; margin-top: 5px;">
	<a class="fancybox" title="头像" href="${tx }.jpg" 
		data-fancybox-group="gallery">
		<img src="${tx }" alt="头像"
		 style="width: 2.5em; height:2.5em; border-radius:100%; background: #fff; padding: 4px; margin-left:14%; border: 1px solid #efefef; float: left;" />
	</a>
</div>
	<div style="line-height: 80px; padding-left:20px; font-size:10px; width: 30%; float: left;">${nickname }&nbsp;</div>
	<div style="line-height: 80px; width: 20%; float: right; color: red;">￥${buyPrice }</div>
</div>
<div style="line-height: 80px; padding-left:20px; font-size:10px; width: 30%; float: left; clear: both;">博文&nbsp;</div>
<h2 style="clear: both;">${title }</h2>
<div style="padding-left: 5%; padding-right: 5%;">&nbsp;&nbsp;&nbsp;&nbsp;
${content }
</div>

<c:if test="${images != null}">
	<c:forEach items="${images }" var="img" varStatus="vs">
		<div style="width: 99%; margin:0 auto;">
			<a class="fancybox" title="图片${vs.index + 1 }" href="${img }" 
				data-fancybox-group="gallery">
				<img src="${img }"
				alt="图片${vs.index + 1 }" style="width: 90%; background: #fff; padding: 4px; margin-left:5%; border: 1px solid #efefef; float: left;" />
			</a>
		</div>
	</c:forEach>
</c:if>
<div>
	<h6 class="xinxi">${addTime } | <!-- 来源：undefined --> 
		<div class="good wzgood" onclick="zan()">
			<img src="${htmlPath}images/p.good.png" style="width: 20px;" align="absmiddle"/>
			好评 (<span class="goodnum">${zanCount }</span>)
		</div>
	</h6>
</div>
<c:if test="${ads != null}">
	<c:forEach items="${ads }" var="ad" varStatus="vs">
		<div style="width: 99%; margin:0 auto;">
			<a class="fancybox" title="广告${vs.index + 1 }" href="${ad.image }" 
				data-fancybox-group="gallery">
				<img src="${ad.image }"
				alt="广告${vs.index + 1 }" style="width: 90%; background: #fff; padding: 4px; margin-left:5%; border: 1px solid #efefef; float: left;" />
			</a>
		</div>
	</c:forEach>
</c:if>
</div>

</body>
</html>
